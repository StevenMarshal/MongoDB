# 1 MongoDB介绍

Not only SQL，泛指非关系型数据库。  

## 1.1 NoSQL数据库的四大分类

* 键值（Key - Value）存储数据库

这类数据库主要会使用到一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。Key – Value模型对于IT系统来说的优势在于简单、易部署。  
但是如果DBA只对部分值进行查询或更新的时候，Key – Value就显得效率低下了。  

举例：  
Tokyo Cabinet/Tyrant、Redis、Voldemort、Oracle BDB

* 列存储数据库

这部分数据库通常时用来应对分布式存储的海量数据。  
键仍然存在，但是它们的特点是指向了多个列。这些列是由列家族来安排的。  

举例：  
Cassandra、HBase、Riak

* 文档型数据库  

文档型数据库的灵感来自于Lotus Notes办公软件的，而且它同第一种键值存储相类似。该类型的数据模型是版本化的文档，半结构化的文档以特定的格式存储，比如JSON。  
文档型数据库可以看作是键值数据库的升级版，允许之间嵌套键值。而且文档型数据库比键值数据库的查询效率要更高。  

举例：  
CouchDB、MongoDB。国内也有文档型数据库SequoiaDB，已经开源。

* 图形（Graph）数据库  

图形结构的数据库同其他行列以及刚性结构的SQL数据库不同，它使用灵活的图形模型，并且能够扩展到多个服务器上。NoSQL数据库没有标准的查询语言（SQL），因此进行数据库查询需要制定数据模型。许多NoSQL数据库都有REST式的数据接口或者查询API。  

例如：  
Neo4J、InfoGrid、infiniteGraph

## 1.2 关系型数据库的交易模式事务控制

* 原子性（Atomicity）

指一个事务要么全部执行，要么完全不执行。

* 一致性（Consistency）  

事务在开始和结束时，应该始终满足一致性约束。

* 事务独立（Isolation）

如果有多个事务同时执行，彼此之间不需要知晓对方的存在，而且执行时互不影响，事务之间需要序列化执行，有时间顺序。  

* 持久性（Durability）  

事务的持久性是指事务运行成功以后，对系统状态的更新是永久的，不会无缘无故的回滚撤销。  

## 1.3 NoSQL的CAP理论（CAP Theorem）  

在一个分布式系统中连续性/一致性（Consistency）、有效性（availability
）、分区容错性（Partition  tolerance）三者不可兼得，一定要有所取舍。换句话说也就是只能满足其中的两个特性。  


## 1.4 ACID的一致性与CAP的一致性

* ACID中的一致性：  

指事务的执行不能破坏数据库数据的完整性和一致性，一个事务在执行前后，数据库都必须处于一致性状态。换句话说，事务的执行结果必须是数据库从一个一致状态转变到另一个一致状态。  

* CAP中的一致性  

在分布环境中，一致性是指数据在多个副本之间是否能够保持一致的特性。  

## 1.5Base理论  

BASE是指基本可用（Basically Availiable）、软状态（Soft State）、最终一致性（Eventual Consistency）。

* 基本可用（Basically Availiable）  

基本可用是指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用。  

例如：  
为了应对访问量激增，部分用户可能会被引导到降级页面，服务层也可能只提供降级服务。这就是损失部分可用性的体现。

* 软状态（Soft State）  

软状态是指允许系统存在中间状态，而该中间状态不会影响系统整体可用性，分布式存储中一般一份数据至少会有三个副本，允许不同节点间副本同步的延时就是软状态的体现。  
MySQL Replication的异步复制也是一种体现。  

* 最终一致性（Eventual Consistency）

最终一致性是指系统中所有数据副本经过一定时间后，最终能够达到一致的状态，弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。
